#=============================================================
# 練習課題：code20.Rで学んだ内容を復習しよう！
# データ：ten_kukan100.csv（100人分の身長・体重データ）
#=============================================================
# ルール：
# - 各課題の下に自分でコードを書いてみよう
# - わからなくなったら code20.R を見返してOK
# - コメント（#）の中にヒントを書いてあるよ
#=============================================================


#=============================================================
# 【準備】 Rを使う下準備
#=============================================================

# 課題0-1: 全部の変数を消そう
# ヒント: rm(list=ls())


# 課題0-2: 作業フォルダを確認して、設定しよう
# ヒント: getwd() と setwd() を使う


# 課題0-3: 必要なパッケージを読み込もう
# ヒント: library() で tidyverse, ggplot2, ggthemes, gtsummary, psych を読み込む


# 課題0-4: テーマを設定しよう（下のコードはそのまま実行してOK）
theme_set(theme_grey(base_family = "HiraginoSans-W3"))
theme_set(theme_gray(
  base_family = "HiraginoSans-W3",
  base_size = 11,
  base_line_size = 0.2,
  base_rect_size = 0.2
))


#=============================================================
# 【課題1】 データを読み込んで構造を確認しよう
#=============================================================

# 課題1-1: ten_kukan100.csv を読み込んで ten_kukan100 に入れよう
# ヒント: read_csv("Lesson01_R_basics/ten_kukan100.csv")


# 課題1-2: str() でデータの構造を確認しよう


# 課題1-3: nrow(), ncol(), dim() で行数・列数を確認しよう
# → 何人分のデータ？ 何種類の変数がある？


# 課題1-4: names() で列名を確認しよう


# 課題1-5: head() と tail() でデータの最初と最後を見よう


# 課題1-6: View() でデータ全体を確認しよう


#=============================================================
# 【課題2】 変数を取り出して、カテゴリ変数を作ろう
#=============================================================

# 課題2-1: height, weight, sex をそれぞれ変数に入れよう
# ヒント: height <- (ten_kukan100$height) のように書く


# 課題2-2: sex を「女性」「男性」のカテゴリ変数（sex_c）に変換しよう
# ヒント: mutate() と factor() を使う。levels = 1:2, labels = c("女性","男性")


# 課題2-3: head() で変換後のデータを確認しよう


# 課題2-4: table() で男女の人数を確認しよう
# ヒント: ten_kukan100 %>% with(table(sex_c))


# 課題2-5: sex_c を変数に取り出しておこう


#=============================================================
# 【課題3】 基本統計量を計算しよう
#=============================================================

# 課題3-1: 身長の平均値を出そう
# ヒント: mean()


# 課題3-2: 体重の平均値を出そう


# 課題3-3: 男性の身長の平均値を出そう
# ヒント: subset() で男性だけ取り出してから mean()


# 課題3-4: 女性の身長の平均値を出そう


# 課題3-5: 身長の標準偏差を出そう
# ヒント: sd()


# 課題3-6: 体重の標準偏差を出そう


# 課題3-7: 男性の身長の標準偏差を出そう


# 課題3-8: 女性の身長の標準偏差を出そう


#=============================================================
# 【課題4】 平均・標準偏差以外の統計量も出してみよう
#=============================================================

# 課題4-1: 身長と体重の中央値を出そう
# ヒント: median()


# 課題4-2: 身長の最大値と最小値を出そう
# ヒント: max(), min()


# 課題4-3: 身長の範囲を出そう
# ヒント: range()


# 課題4-4: 身長の四分位数を出そう
# ヒント: quantile()


# 課題4-5: 身長の四分位範囲（IQR）を出そう
# ヒント: IQR()


# 課題4-6: summary() と describe() でまとめて確認しよう


#=============================================================
# 【課題5】 tidyverseでデータ操作をしよう
#=============================================================

# 課題5-1: filter() で男性だけのデータを取り出そう


# 課題5-2: filter() で身長165cm以上のデータを取り出そう


# 課題5-3: filter() で女性かつ体重50kg以上のデータを取り出そう
# ヒント: 複数の条件はカンマで区切る


# 課題5-4: select() で height と weight の列だけ取り出そう


# 課題5-5: arrange() で体重の重い順（降順）に並び替えよう
# ヒント: arrange(desc(weight))


# 課題5-6: group_by() + summarise() で男女別の人数・平均身長・SD身長・平均体重・SD体重を出そう
# ヒント: group_by(sex_c) %>% summarise(人数 = n(), ...)


# 課題5-7: mutate() でBMIの列を追加しよう
# ヒント: BMI = weight / (height / 100) ^ 2


# 課題5-8: head() でBMIが追加されたか確認しよう


#=============================================================
# 【課題6】 テーブルを作ろう（tbl_summary）
#=============================================================

# 課題6-1: tbl_summary() でデータセット全体のテーブルを作ろう


# 課題6-2: ラベル付きのテーブルを作ろう
# ヒント: select() で height, weight, sex_c を選んでから
#         tbl_summary(label = list(...), statistic = list(all_continuous() ~ "{mean} ±{sd}"), ...)


# 課題6-3: 男女別（by = sex_c）のテーブルを作ろう


#=============================================================
# 【課題7】 相関分析をしよう
#=============================================================

# 課題7-1: 身長と体重の相関係数を計算しよう
# ヒント: cor(height, weight)


# 課題7-2: cor.test() で相関係数の検定をしよう
# → p-value はいくつ？ 有意な相関はある？


# 課題7-3: 男性だけの身長と体重の相関係数を出そう
# ヒント: filter() で男性だけ取り出してから cor()


# 課題7-4: 女性だけの身長と体重の相関係数を出そう


# 課題7-5: 相関行列を作ろう
# ヒント: select(height, weight) %>% cor()


#=============================================================
# 【課題8】 t検定をしよう
#=============================================================

# 課題8-1: 男女の平均身長に有意差があるかt検定しよう
# ヒント: t.test(height ~ sex, var.equal = TRUE)
# → p-value はいくつ？ 有意差はある？


#=============================================================
# 【課題9】 散布図を描こう
#=============================================================

# 課題9-1: 身長(x軸) と 体重(y軸) の散布図を描こう
# ヒント: ggplot(data = ...) + aes(x = ..., y = ...) + geom_point()


# 課題9-2: 男女別に色分けした散布図を描こう
# ヒント: aes() の中に colour = sex_c を追加


#=============================================================
# 【課題10】 ヒストグラムを描こう
#=============================================================

# 課題10-1: 身長のヒストグラムを描こう
# ヒント: geom_histogram(bins = 15) ← 100人なのでbinsを多めに


# 課題10-2: 男女別に色を分けたヒストグラムを描こう
# ヒント: aes(x = height, fill = sex_c) + geom_histogram(alpha = 0.6, position = "identity")


#=============================================================
# 【課題11】 密度プロットを描こう
#=============================================================

# 課題11-1: 男女別の身長の密度プロットを描こう
# ヒント: geom_density(alpha = 0.3)


#=============================================================
# 【課題12】 棒グラフを描こう
#=============================================================

# 課題12-1: 性別ごとの人数を棒グラフで描こう
# ヒント: geom_bar()


#=============================================================
# 【課題13】 箱ひげ図を描こう
#=============================================================

# 課題13-1: 男女別の身長の箱ひげ図を描こう
# ヒント: aes(x = sex_c, y = height, fill = sex_c) + geom_boxplot()


# 課題13-2: 箱ひげ図にデータポイント（jitter）を重ねよう
# ヒント: geom_jitter(width = 0.1, shape = 21, colour = "BLACK", size = 2)


# 課題13-3: 箱ひげ図にt検定の有意差マーク（*）を追加しよう
# ヒント: library(ggsignif) して geom_signif() を使う


#=============================================================
# 【課題14】 エラーバー付きプロットを描こう
#=============================================================

# 課題14-1: 男女別の平均身長をSEエラーバー付きで描こう
# ヒント: stat_summary(fun = "mean", geom = "point") +
#         stat_summary(fun.data = "mean_se", geom = "errorbar")


#=============================================================
# 【課題15】 グラフのカスタマイズと保存
#=============================================================

# 課題15-1: labs() を使って散布図にタイトル・軸ラベル・キャプションをつけよう
# ヒント: labs(title = "...", subtitle = "...", x = "...", y = "...", caption = "...")


# 課題15-2: 好きなグラフを変数に入れて、ggsave() でPNG形式で保存しよう
# ヒント: ggsave("height/my_result.png", plot = ..., width = 8, height = 6, dpi = 300)


#=============================================================
# 【ボーナス課題】 自由にやってみよう！
#=============================================================

# ボーナス1: 体重のヒストグラムと密度プロットを重ねて描いてみよう
# ヒント: geom_histogram(aes(y = after_stat(density)), ...) + geom_density(...)


# ボーナス2: group_by() + summarise() の結果を geom_col() で棒グラフにしてみよう
# ヒント: まず集計結果を変数に入れてから、ggplot() + geom_col() で描く


# ボーナス3: code20.Rの結果と比較してみよう
# → 20人と100人で平均値や標準偏差はどう変わった？
# → サンプルサイズが大きいとグラフの形はどう変わる？

